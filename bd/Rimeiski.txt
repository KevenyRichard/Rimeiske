
CREATE DATABASE Rimeiski;
USE Rimeiski;

CREATE TABLE setor(
cod_setor INT(3) AUTO_INCREMENT NOT NULL,
nome_setor VARCHAR(25) NOT NULL,
CONSTRAINT pk_cod_setor PRIMARY KEY (cod_setor),
CONSTRAINT u_nome_setor UNIQUE(nome_setor)
);

CREATE TABLE cliente(
cod_cliente INT(6) AUTO_INCREMENT NOT NULL,
nome_cliente VARCHAR(45) NOT NULL,
cpf BIGINT(11) ZEROFILL NOT NULL,
ra INT(8) NOT NULL,
celular INT(11),
tipo INT(1) DEFAULT (0),
acervo INT(3),
senha VARCHAR(32) NOT NULL,
CONSTRAINT pk_cod_cliente PRIMARY KEY (cod_cliente),
CONSTRAINT u_cpf UNIQUE(cpf),
CONSTRAINT u_ra UNIQUE(ra),
CONSTRAINT ck_tipo CHECK(tipo IN (0,1,2)),
CONSTRAINT fk_acervo FOREIGN KEY (acervo) REFERENCES setor(cod_setor) ON DELETE SET NULL
);

CREATE TABLE local(
cod_local INT(6) AUTO_INCREMENT NOT NULL,
departamento INT(1) DEFAULT(0) NOT NULL,
nome_local VARCHAR(25) NOT NULL,
CONSTRAINT pk_cod_local PRIMARY KEY (cod_local),
CONSTRAINT u_nome_local UNIQUE(nome_local)
);

CREATE TABLE produto(
cod_produto INT(6) AUTO_INCREMENT NOT NULL,
categoria INT(1) DEFAULT(0) NOT NULL,
nome_produto VARCHAR(45) NOT NULL,
quantidade INT(3),
patrimonio varchar(10),
garantia DATE,
ativo BOOLEAN NOT NULL,
CONSTRAINT pk_cod_produto PRIMARY KEY (cod_produto),
CONSTRAINT u_patrimonio UNIQUE(patrimonio),
CONSTRAINT ck_categoria CHECK(categoria IN ('0','1')),
CONSTRAINT ck_ativo CHECK(ativo IN ('0','1')),
CONSTRAINT ck_quantidade CHECK(quantidade>=0)
);

CREATE TABLE chamado(
cod_chamado INT(6) AUTO_INCREMENT NOT NULL,
descricao VARCHAR(250) NOT NULL,
fk_local INT(6) NOT NULL,
fk_cliente INT(6),
nome_cli VARCHAR(45) NOT NULL,
fk_setor INT(3) NOT NULL,
funcionario INT(8) DEFAULT(NULL),
nome_func VARCHAR(45),
cancelamento VARCHAR(150),
data_agendado TIMESTAMP NOT NULL,
data_pedido TIMESTAMP DEFAULT (CURRENT_TIMESTAMP()),
data_finalizado TIMESTAMP NULL,
CONSTRAINT pk_cod_chamado PRIMARY KEY (cod_chamado),
CONSTRAINT u_cod_chamado UNIQUE (fk_cliente,fk_local,data_agendado),
CONSTRAINT fk_cod_do_setor FOREIGN KEY (fk_setor) REFERENCES setor(cod_setor),
CONSTRAINT fk_cod_do_local FOREIGN KEY (fk_local) REFERENCES local(cod_local),
CONSTRAINT fk_cod_do_cliente FOREIGN KEY (fk_cliente) REFERENCES cliente(cod_cliente) ON DELETE SET NULL
);

CREATE TABLE agenda(
cod_agenda INT(6) AUTO_INCREMENT NOT NULL,
fk_chamado INT(6) NOT NULL,
fk_func INT(6) NOT NULL,
CONSTRAINT pk_cod_agenda PRIMARY KEY (cod_agenda),
CONSTRAINT fk_codigo_chamado FOREIGN KEY (fk_chamado)REFERENCES chamado(cod_chamado),
CONSTRAINT u_duplserv UNIQUE (fk_chamado,fk_func)
);

CREATE TABLE andamento(
cod_andamento INT(6) AUTO_INCREMENT NOT NULL,
saida_produto TIMESTAMP,
retorno_produto TIMESTAMP,
descricao_chamado VARCHAR(250),
fk_cod_produto INT(6) NOT NULL,
fk_agenda INT(6) NOT NULL,
fk_cod_chamado INT(6) NOT NULL,
fk_cod_func INT(6) NOT NULL,
CONSTRAINT pk_cod_andamento PRIMARY KEY (cod_andamento),
CONSTRAINT fk_codigo_prod FOREIGN KEY (fk_cod_produto) REFERENCES produto(cod_produto),
CONSTRAINT fk_cod_agenda FOREIGN KEY (fk_agenda) REFERENCES agenda(cod_agenda),
CONSTRAINT fk_codigo_chamados FOREIGN KEY (fk_cod_chamado) REFERENCES chamado(cod_chamado)
);

CREATE TABLE produto_local(
cod_local_do_produto INT(6) AUTO_INCREMENT NOT NULL,
fk_produto INT(6) NOT NULL,
local_atual INT(6) NOT NULL,
local_original INT(6) NOT NULL,
data_entrada DATE NOT NULL,
CONSTRAINT pk_cod_local_do_produto PRIMARY KEY (cod_local_do_produto),
CONSTRAINT fk_codigo_produto FOREIGN KEY (fk_produto)REFERENCES produto(cod_produto),
CONSTRAINT fk_local_atual FOREIGN KEY (local_atual)REFERENCES local(cod_local),
CONSTRAINT fk_local_original FOREIGN KEY (local_original)REFERENCES local(cod_local)
);

CREATE TABLE avaliacao(
cod_avaliacao INT(6) AUTO_INCREMENT NOT NULL,
descricao_avaliacao VARCHAR(250) NOT NULL,
fk_avaliador INT(6),
CONSTRAINT pk_avaliacao PRIMARY KEY (cod_avaliacao),
CONSTRAINT fk_avaliador FOREIGN KEY (fk_avaliador) REFERENCES cliente(cod_cliente)
);

INSERT INTO `setor` (`cod_setor`, `nome_setor`) VALUES
('1', 'TI/AudioVisual');

INSERT INTO `cliente` (`nome_cliente`,`cpf`,`ra`,`tipo`,`acervo`,`senha`) VALUES
('Keveny Richard Lima Bezerra', 03541175214, 12274, 1, 1,'202cb962ac59075b964b07152d234b70');

INSERT INTO `cliente` (`cod_cliente`, `nome_cliente`, `cpf`, `ra`, `tipo`, `acervo`, `senha`) VALUES
(NULL, 'Giulius', '12345678909', '12345', '2', 1, '202cb962ac59075b964b07152d234b70');

INSERT INTO `cliente` (`cod_cliente`, `nome_cliente`, `cpf`, `ra`, `tipo`, `acervo`, `senha`) VALUES
(NULL, 'ADMINISTRADOR GERAL', '00000000000', '00000', '2', '1', '202cb962ac59075b964b07152d234b70');

INSERT INTO `cliente` (`cod_cliente`, `nome_cliente`, `cpf`, `ra`, `tipo`, `acervo`, `senha`) VALUES
(NULL, 'Yudi Yuehara', '03333333333', '33333', '1', '1', '202cb962ac59075b964b07152d234b70');

INSERT INTO `cliente` (`cod_cliente`, `nome_cliente`, `cpf`, `ra`, `tipo`, `acervo`, `senha`) VALUES
(NULL, 'Emanuel Vaz', '04444444444', '44444', '1', '1', '202cb962ac59075b964b07152d234b70');

INSERT INTO `cliente` (`cod_cliente`, `nome_cliente`, `cpf`, `ra`, `tipo`, `acervo`, `senha`) VALUES
(NULL, 'Vini', '05555555555', '55555', '0', NULL, '202cb962ac59075b964b07152d234b70');

INSERT INTO `local` (`nome_local`,`departamento`) VALUES
('TI - Audio Visual', 1),
('Biblioteca', 1),
('Secretaria Academica', 1),
('Ciunem', 1),
('Administração Predial', 1),
('Direção', 1),
('RH - Recursos Humanos', 1),
('Telefonia', 1),
('Agencia de Noticias', 1),
('Mecanografia', 1),
('Centro de Psicologia Aplicada', 1),
('EAD - Educação a Distância', 1),
('Cartório', 1),
('CSE - Centro Saude Escola', 1),
('CAC - Central De Atendimento Ao Candidato', 1),
('Coordenação de Laborátorios', 1),
('Vigilância', 1),
('Tesouraria', 1),
('Semi-Presencial', 1),
('Patrimônio', 1),
('Compras', 1),
('CE - Centro De Estética e Cosmética', 1),
('LAC - Laboratório De Analises Clinicas', 1),
('Pós Graduação', 1),
('FIES - Juridico', 1),
('Esterilização', 1),
('Coordenação - Biomedicina, enfermagem, estetica e cosmetica, psicologia', 1),
('Coordenação - Administração, arquitetura, Ads, direito', 1),
('Triagem Odontologia', 1),
('Lavanderia', 1),
('Zeladoria', 1),
('NPJ - Nucleo Juridico', 1),
('Nivel A', 2),
('Laboratório Pós', 2),
('Sala De Aula - A01', 0),
('Sala De Aula - Pós 01', 0),
('Sala De Aula - Pós 02', 0),
('Sala De Aula - Pós 03', 0),
('Sala De Aula - Pós 04', 0),
('Sala De Aula - Pós 05', 0),
('Sala De Aula - Pós 06', 0),
('Sala De Aula - Pós 07', 0),
('Sala De Aula - Pós 08', 0),
('Sala De Aula - Pós 09', 0),
('Sala De Aula - Pós 10', 0),
('Nivel B', 2),
('Sala De Aula - B01', 0),
('Sala De Aula - B02', 0),
('Sala De Aula - B03', 0),
('Sala De Aula - B04', 0),
('Sala De Aula - B05', 0),
('Sala De Aula - B06', 0),
('Sala De Aula - B07', 0),
('Sala De Aula - B08', 0),
('Sala De Aula - B09', 0),
('Sala De Aula - B10', 0),
('Sala De Aula - B11', 0),
('Nivel C', 2),
('Sala De Aula - C01', 0),
('Sala De Aula - C02', 0),
('Sala De Aula - C03', 0),
('Sala De Aula - C04', 0),
('Sala De Aula - C05', 0),
('Sala De Aula - C06', 0),
('Sala De Aula - C10', 0),
('Sala De Aula - C11', 0),
('Sala De Aula - C12', 0),
('Sala De Aula - C13', 0),
('Sala De Aula - C14', 0),
('Sala De Aula - C15', 0),
('Sala De Aula - C16', 0),
('Sala De Aula - C17', 0),
('Sala De Aula - C18', 0),
('Sala De Aula - C19', 0),
('Sala De Aula - C20', 0),
('Sala De Aula - C21', 0),
('Sala De Aula - C22', 0),
('Sala De Aula - C23', 0),
('Nivel D', 2),
('Próximo a Biblioteca', 2),
('Próximo ao Audio Visual', 2),
('Mezanino', 2),
('Próximo ao Mezanino', 2),
('Sala De Aula - D01', 0),
('Sala De Aula - D02', 0),
('Sala De Aula - D03', 0),
('Sala De Aula - D04', 0),
('Sala De Aula - D05', 0),
('Sala De Aula - D06', 0),
('Sala De Aula - D07', 0),
('Sala De Aula - D08', 0),
('Sala De Aula - D09', 0),
('Sala De Aula - D10', 0),
('Sala De Aula - D11', 0),
('Sala De Aula - D12', 0),
('Sala De Aula - D13', 0),
('Sala De Aula - D14', 0),
('Sala De Aula - D15', 0),
('Sala De Aula - D16', 0),
('Sala De Aula - D17', 0),
('Sala De Aula - D18', 0),
('Sala De Aula - D19', 0),
('Sala De Aula - D20', 0),
('Sala De Aula - D21', 0),
('Sala De Aula - D22', 0),
('Sala De Aula - D23', 0),
('Sala De Aula - D24', 0),
('Sala De Aula - D25', 0),
('Sala De Aula - D26', 0),
('Sala De Aula - D27', 0),
('Sala De Aula - D28', 0),
('Sala De Aula - D29', 0),
('Sala De Aula - D30', 0),
('Sala De Aula - D31', 0),
('Sala De Aula - D32', 0),
('Sala De Aula - D33', 0),
('Sala De Aula - D34', 0),
('Nivel E', 2),
('Sala De Aula - E01', 0),
('Sala De Aula - E02', 0),
('Sala De Aula - E03', 0),
('Sala De Aula - E04', 0),
('Sala De Aula - E05', 0),
('Nenhuma Das Anteriores', 2)
;

INSERT INTO `chamado` (`descricao`,`fk_local`,`fk_cliente`,`fk_setor`,`data_agendado`) VALUES
('projetor com problema','1','3','1','2022-12-19 16:38:13');

INSERT INTO `produto` (`cod_produto`, `nome_produto`, `quantidade`, `categoria`,  `patrimonio`, `garantia`, `ativo`) VALUES
(NULL, 'Cabo HDMI', '2', '1', '', NULL, '0');

INSERT INTO `produto_local` (`cod_local_do_produto`, `fk_produto`, `local_atual`, `local_original`, `data_entrada`) VALUES
(NULL, '1', '50', '51', '2022-11-15 19:59:00');